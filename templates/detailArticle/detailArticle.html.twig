{% extends 'base.html.twig' %}

{% block stylesheets %}
    <link href="{{ asset('css/detailArticle/detailArticle.css') }}" rel="stylesheet">
{% endblock %}

{% block body %}
<section>
    <div class="container_fluid">
        <div class="block-item row">
            <div class="product-slider col-xs-12">
                <div id="carousel" class="carousel slide col-xs-12 text-center" data-ride="carousel">
                    <div class="carousel-inner">
                        <div class="block-modify offset-lg-8 col-lg-1 ">
                            {% if pictures is defined %}
                                    <a class="modify_item fa fa-pen-fancy col-xs-3" href="{{ path('app_modify', {id: item.id}) }}"></a>
                                    <a class="delete_item fa fa-trash-alt text-right col-xs-3" href="{{ path('app_delete_article', {id: item.id}) }}"></a>
                            {% endif %}
                        </div>
                        {% for picture in pictures %}
                            <div class="carousel-item col-xs-12 item{% if loop.index == 1 %} active {% endif %}">
                                <img class="img-carousel col-xs-12" src="/img/imgPost/{{ picture.name }}.{{ picture.extension }}" alt="{{ picture.description}}" />
                            </div>
                        {% endfor %}
                        {% for movie in movies %}
                            <div class="carousel-item col-xs-12 item">
                                    <iframe width="560" height="315" src="{{ movie.link }}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="clearfix">
                    <div id="thumbcarousel" class="carousel slide" data-interval="false">
                        <div class="carousel-inner">
                            <div class="item active">
                                {% for picture in pictures %}
                                    <div data-target="#carousel" data-slide-to="#" class="thumb">
                                        <img class="img-thumb" src="/img/imgPost/{{ picture.name }}.{{ picture.extension }}" alt="{{ picture.description}}"/>
                                    </div>
                                {% endfor %}
                                {% for movie in movies %}
                                    <div data-target="#carousel" data-slide-to="#" class="thumb">
                                        <a>video</a>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="block-text container">
                <div class="row">
                    <div class="title col-lg-12 col-xs-12 text-center">
                        <h3>{{ item.title }}</h3>
                    </div>
                    <div class="chapo col-lg-12 col-xs-12 text-center">
                        <p>{{ item.chapo }}</p>
                    </div>
                    <div class="content col-lg-12 col-xs-12 text-center">
                        <p>{{ item.content }}</p>
                    </div>
                </div>
            </div>

            {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                {{ form(form) }}
            {% endif %}

            <div class="container">
                <div class="row">
                    <div class="block-comment offset-lg-3 col-lg-6 col-xs-12">
                    {% for comment in comments %}
                        <div class="comment col-lg-12 col-xs-12 text-center">
                            <p>{{ comment.comment }}</p>
                        </div>
                        <div class="author-and-date col-lg-12 col-xs-12 text-center">
                            <p>auteur: {{ comment.name }} le {{ comment.dateCreate|date('d/m/Y') }}</p>
                        </div>

                    {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="more_item">
        <div class="container">
            <div class="block_btn_more text-center col-xs-12">
                <button id="btn-more" class="btn btn-warning"><i class="fa fa-angle-down"></i>Afficher plus</button>
            </div>
        </div>
</section>
{%  endblock %}

{% block javascripts %}
    <script>
        jQuery(document).ready( function () {
            let number_comment_load = 10;
            let number_comment_in_the_bdd = {{ numberItems }};
            let id_item = {{ item.id }};
            if (number_comment_load >= number_comment_in_the_bdd) {
                $(".more_item").hide();
            }
            $("#btn-more").click(function(e){
                e.preventDefault();
                $.ajax({
                    url: '{{ path('app_comment_pagination') }}',
                    type: 'POST',
                    data: 'numberCommentLoad=' + number_comment_load +
                        '&id=' + id_item,
                    dataType: 'text',

                    success : function(code_html) { // success est toujours en place, bien s√ªr !
                        let newComment = JSON.parse(code_html);
                        console.log(newComment);
                        number_comment_load += 10;
                        for (let i = 0; i < newComment.length; i++) {
                            jQuery('.block-comment').append('' +
                                '<div class="comment col-lg-12 col-xs-12 text-center">\n'+
                                '   <p>'+ newComment[i].comment +'</p>\n' +
                                '</div>\n' +
                                '<div class="author-and-date col-lg-12 col-xs-12 text-center">\n' +
                                '   <p>auteur: '+ newComment[i].name +' le '+  newComment[i].dateCreate['date'] + '</p>\n' +
                                '</div>');
                            if (number_comment_load >= number_comment_in_the_bdd) {
                                $(".more_item").hide();
                            }
                        }
                    }
                })
            });
            $('.carousel').carousel({interval: false});
            let numberThumb = $('.thumb').length;
            for(let counter = 0; counter < numberThumb; counter++)
            {
                $('.thumb').eq(counter).attr('data-slide-to', counter);
            }

        });
    </script>
{% endblock %}